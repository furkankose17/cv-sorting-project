<core:FragmentDefinition
    xmlns="sap.m"
    xmlns:core="sap.ui.core"
    xmlns:f="sap.f">
    <Dialog
        id="jouleChatDialog"
        title="{i18n>jouleAssistant}"
        contentWidth="500px"
        contentHeight="600px"
        resizable="true"
        draggable="true"
        stretch="{device>/system/phone}">
        <customHeader>
            <Bar>
                <contentLeft>
                    <HBox alignItems="Center">
                        <core:Icon src="sap-icon://da" class="sapUiSmallMarginEnd" />
                        <Title text="{i18n>jouleAssistant}" level="H5" />
                    </HBox>
                </contentLeft>
                <contentRight>
                    <Button
                        icon="sap-icon://delete"
                        tooltip="{i18n>clearChat}"
                        press=".onClearChat"
                        type="Transparent" />
                </contentRight>
            </Bar>
        </customHeader>
        <content>
            <VBox class="sapUiSmallMargin" height="100%">
                <!-- Chat Messages Area -->
                <ScrollContainer
                    id="chatScrollContainer"
                    height="100%"
                    width="100%"
                    vertical="true"
                    horizontal="false"
                    class="sapUiTinyMarginBottom">
                    <List
                        id="chatMessagesList"
                        items="{jouleChat>/messages}"
                        showSeparators="None"
                        growing="true"
                        growingThreshold="50">
                        <items>
                            <CustomListItem>
                                <HBox
                                    justifyContent="{= ${jouleChat>role} === 'user' ? 'End' : 'Start'}"
                                    class="sapUiTinyMargin">
                                    <VBox
                                        class="{= ${jouleChat>role} === 'user' ? 'sapUiTinyMarginBegin jouleUserMessage' : 'sapUiTinyMarginEnd jouleAssistantMessage'}"
                                        width="80%">
                                        <HBox alignItems="Center" class="sapUiTinyMarginBottom">
                                            <core:Icon
                                                src="{= ${jouleChat>role} === 'user' ? 'sap-icon://person-placeholder' : 'sap-icon://da'}"
                                                class="sapUiTinyMarginEnd"
                                                visible="{= ${jouleChat>role} !== 'user'}" />
                                            <Text
                                                text="{= ${jouleChat>role} === 'user' ? 'You' : 'Joule'}"
                                                class="sapUiTinyMarginEnd sapMTextBold" />
                                            <Text
                                                text="{jouleChat>timestamp}"
                                                class="sapUiTinyText" />
                                        </HBox>
                                        <FormattedText
                                            htmlText="{jouleChat>content}"
                                            class="jouleMessageContent" />
                                    </VBox>
                                </HBox>
                            </CustomListItem>
                        </items>
                    </List>
                </ScrollContainer>

                <!-- Typing Indicator -->
                <HBox
                    visible="{jouleChat>/isTyping}"
                    alignItems="Center"
                    class="sapUiSmallMarginBottom">
                    <core:Icon src="sap-icon://da" class="sapUiTinyMarginEnd" />
                    <BusyIndicator size="XS" />
                    <Text text="{i18n>jouleTyping}" class="sapUiTinyMarginBegin" />
                </HBox>

                <!-- Input Area -->
                <HBox width="100%" alignItems="Center">
                    <Input
                        id="jouleInput"
                        placeholder="{i18n>askJoulePlaceholder}"
                        value="{jouleChat>/inputValue}"
                        width="100%"
                        submit=".onSendMessage"
                        class="sapUiTinyMarginEnd" />
                    <Button
                        icon="sap-icon://paper-plane"
                        type="Emphasized"
                        press=".onSendMessage"
                        enabled="{= ${jouleChat>/inputValue} !== '' &amp;&amp; !${jouleChat>/isTyping}}" />
                </HBox>

                <!-- Quick Actions -->
                <HBox class="sapUiSmallMarginTop" wrap="Wrap">
                    <Button
                        text="{i18n>quickActionSkills}"
                        type="Ghost"
                        class="sapUiTinyMarginEnd sapUiTinyMarginBottom"
                        press=".onQuickAction"
                        customData:action="skills" />
                    <Button
                        text="{i18n>quickActionPipeline}"
                        type="Ghost"
                        class="sapUiTinyMarginEnd sapUiTinyMarginBottom"
                        press=".onQuickAction"
                        customData:action="pipeline" />
                    <Button
                        text="{i18n>quickActionMatches}"
                        type="Ghost"
                        class="sapUiTinyMarginBottom"
                        press=".onQuickAction"
                        customData:action="matches" />
                </HBox>
            </VBox>
        </content>
        <beginButton>
            <Button
                text="{i18n>close}"
                press=".onCloseJouleChat" />
        </beginButton>
    </Dialog>
</core:FragmentDefinition>
