<?xml version="1.0" encoding="UTF-8"?>
<mvc:View
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:layout="sap.ui.layout"
    controllerName="cv.sorting.analytics.controller.Dashboard">

    <f:DynamicPage id="dashboardPage" headerExpanded="true">
        <f:title>
            <f:DynamicPageTitle id="dashboardPageTitle">
                <f:heading>
                    <Title id="dashboardTitle" text="{i18n>dashboardTitle}" />
                </f:heading>
                <f:actions>
                    <Button
                        id="btnRefresh"
                        text="{i18n>refresh}"
                        icon="sap-icon://refresh"
                        press="onRefresh" />
                    <Button
                        id="btnExport"
                        text="{i18n>exportReport}"
                        icon="sap-icon://excel-attachment"
                        press="onExportReport" />
                </f:actions>
            </f:DynamicPageTitle>
        </f:title>

        <f:header>
            <f:DynamicPageHeader id="dashboardHeader" pinnable="true">
                <f:content>
                    <layout:HorizontalLayout id="headerLayout" allowWrapping="true">
                        <DateRangeSelection
                            id="dateRange"
                            change="onDateRangeChange"
                            placeholder="{i18n>selectDateRange}" />
                    </layout:HorizontalLayout>
                </f:content>
            </f:DynamicPageHeader>
        </f:header>

        <f:content>
            <layout:VerticalLayout id="mainLayout" width="100%" class="sapUiSmallMargin">
                <!-- KPI Cards Row -->
                <layout:HorizontalLayout id="kpiCardsLayout" allowWrapping="true" class="sapUiMediumMarginBottom">
                    <!-- Total Candidates Card -->
                    <f:Card id="cardTotalCandidates" class="sapUiSmallMarginEnd sapUiPointer" width="280px">
                        <f:header>
                            <card:Header
                                id="headerTotalCandidates"
                                title="{i18n>totalCandidates}"
                                subtitle="{i18n>allTime}"
                                statusText="{dashboard>/pipelineData/totalCandidates}"
                                press="onTotalCandidatesPress" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numTotalCandidates"
                                value="{dashboard>/pipelineData/totalCandidates}"
                                scale=""
                                valueColor="Good"
                                icon="sap-icon://group"
                                press="onTotalCandidatesPress"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Active Jobs Card -->
                    <f:Card id="cardActiveJobs" class="sapUiSmallMarginEnd" width="280px">
                        <f:header>
                            <card:Header
                                id="headerActiveJobs"
                                title="{i18n>activeJobs}"
                                subtitle="{i18n>currentlyOpen}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numActiveJobs"
                                value="{dashboard>/jobsData/activeJobs}"
                                scale=""
                                valueColor="Neutral"
                                icon="sap-icon://activity-items"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Avg Match Score Card -->
                    <f:Card id="cardAvgMatch" class="sapUiSmallMarginEnd" width="280px">
                        <f:header>
                            <card:Header
                                id="headerAvgMatch"
                                title="{i18n>avgMatchScore}"
                                subtitle="{i18n>acrossAllMatches}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numAvgMatch"
                                value="{dashboard>/matchingData/avgScore}"
                                scale="%"
                                valueColor="Critical"
                                icon="sap-icon://target-group"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Time to Hire Card -->
                    <f:Card id="cardTimeToHire" width="280px" class="sapUiSmallMarginEnd">
                        <f:header>
                            <card:Header
                                id="headerTimeToHire"
                                title="{i18n>avgTimeToHire}"
                                subtitle="{i18n>inDays}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numTimeToHire"
                                value="{dashboard>/pipelineData/avgTimeToHire}"
                                scale="{i18n>days}"
                                valueColor="Neutral"
                                icon="sap-icon://pending"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Upcoming Interviews Card -->
                    <f:Card id="cardUpcomingInterviews" class="sapUiSmallMarginEnd sapUiPointer" width="280px">
                        <f:header>
                            <card:Header
                                id="headerUpcomingInterviews"
                                title="{i18n>upcomingInterviews}"
                                subtitle="{i18n>thisWeek}"
                                press="onNavigateToInterviews" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numUpcomingInterviews"
                                value="{dashboard>/interviewData/upcomingCount}"
                                scale=""
                                valueColor="Critical"
                                icon="sap-icon://appointment"
                                press="onNavigateToInterviews"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Interview Completion Rate Card -->
                    <f:Card id="cardInterviewRate" width="280px">
                        <f:header>
                            <card:Header
                                id="headerInterviewRate"
                                title="{i18n>completionRate}"
                                subtitle="{i18n>interviews}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numInterviewRate"
                                value="{dashboard>/interviewData/completionRate}"
                                scale="%"
                                valueColor="Good"
                                icon="sap-icon://complete"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>
                </layout:HorizontalLayout>

                <!-- Pipeline Status Section -->
                <Panel
                    id="panelPipeline"
                    headerText="{i18n>candidatePipeline}"
                    expandable="true"
                    expanded="true"
                    class="sapUiMediumMarginBottom">
                    <content>
                        <Table
                            id="pipelineTable"
                            items="{dashboard>/pipelineData/byStatus}"
                            growing="true"
                            growingThreshold="10">
                            <columns>
                                <Column id="colStatus"><Text id="txtColStatus" text="{i18n>status}" /></Column>
                                <Column id="colCount" hAlign="End"><Text id="txtColCount" text="{i18n>count}" /></Column>
                                <Column id="colPercent" hAlign="End" width="200px"><Text id="txtColPercent" text="{i18n>percentage}" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem id="pipelineListItem" type="Active" press="onStatusCardPress">
                                    <cells>
                                        <ObjectStatus id="objStatus" text="{dashboard>status}" state="{dashboard>state}" />
                                        <ObjectNumber id="objCount" number="{dashboard>count}" />
                                        <ProgressIndicator
                                            id="progPercent"
                                            percentValue="{dashboard>percentage}"
                                            displayValue="{dashboard>percentage}%"
                                            state="{dashboard>state}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                </Panel>

                <!-- Top Skills Section -->
                <Panel
                    id="panelSkills"
                    headerText="{i18n>topSkills}"
                    expandable="true"
                    expanded="true"
                    class="sapUiMediumMarginBottom">
                    <content>
                        <Table
                            id="skillsTable"
                            items="{dashboard>/skillsData/topSkills}"
                            growing="true"
                            growingThreshold="10">
                            <columns>
                                <Column id="colSkillName"><Text id="txtSkillName" text="{i18n>skillName}" /></Column>
                                <Column id="colCandidateCount" hAlign="End"><Text id="txtCandidateCount" text="{i18n>candidateCount}" /></Column>
                                <Column id="colDemandCount" hAlign="End"><Text id="txtDemandCount" text="{i18n>demandCount}" /></Column>
                                <Column id="colSupplyDemand" hAlign="End"><Text id="txtSupplyDemand" text="{i18n>supplyDemand}" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem id="skillsListItem">
                                    <cells>
                                        <Text id="txtSkill" text="{dashboard>skillName}" />
                                        <ObjectNumber id="numCandidates" number="{dashboard>candidateCount}" />
                                        <ObjectNumber id="numDemand" number="{dashboard>demandCount}" />
                                        <ObjectStatus
                                            id="objRatio"
                                            text="{dashboard>ratio}"
                                            state="{= ${dashboard>ratio} >= 1 ? 'Success' : 'Warning' }" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                </Panel>

                <!-- AI Insights Panel -->
                <Panel
                    id="panelAIInsights"
                    headerText="{i18n>aiInsights}"
                    expandable="true"
                    expanded="true"
                    class="sapUiMediumMarginBottom">
                    <headerToolbar>
                        <Toolbar id="aiInsightsToolbar">
                            <Title id="aiInsightsTitle" text="{i18n>aiInsights}" />
                            <ToolbarSpacer id="aiToolbarSpacer" />
                            <Button
                                id="btnRefreshAI"
                                icon="sap-icon://refresh"
                                tooltip="{i18n>refresh}"
                                press="onRefreshAIInsights" />
                            <Button
                                id="btnAskJoule"
                                text="{i18n>askJoule}"
                                icon="sap-icon://da-2"
                                type="Emphasized"
                                press="onAskJoule" />
                        </Toolbar>
                    </headerToolbar>
                    <content>
                        <VBox id="aiInsightsContent" class="sapUiSmallMargin">
                            <!-- Loading Indicator -->
                            <BusyIndicator
                                id="aiBusyIndicator"
                                visible="{dashboard>/aiData/isLoading}" />

                            <!-- AI Recommendations List -->
                            <List
                                id="aiRecommendationsList"
                                items="{dashboard>/aiData/recommendations}"
                                noDataText="{i18n>msgNoData}"
                                visible="{= !${dashboard>/aiData/isLoading} }">
                                <items>
                                    <StandardListItem
                                        id="aiRecommendationItem"
                                        title="{dashboard>title}"
                                        description="{dashboard>description}"
                                        icon="{= ${dashboard>type} === 'skill_gap' ? 'sap-icon://quality-issue' :
                                               ${dashboard>type} === 'pipeline' ? 'sap-icon://pipeline-analysis' :
                                               ${dashboard>type} === 'candidate' ? 'sap-icon://customer' :
                                               ${dashboard>type} === 'urgent' ? 'sap-icon://warning' :
                                               'sap-icon://hint' }"
                                        info="{dashboard>priority}"
                                        infoState="{= ${dashboard>priority} === 'High' ? 'Error' :
                                                    ${dashboard>priority} === 'Medium' ? 'Warning' : 'None' }"
                                        type="Active"
                                        press="onAIRecommendationPress" />
                                </items>
                            </List>

                            <!-- Empty State -->
                            <IllustratedMessage
                                id="aiEmptyState"
                                illustrationType="sapIllus-EmptyList"
                                title="{i18n>aiRecommendations}"
                                description="{i18n>generateSuggestions}"
                                visible="{= !${dashboard>/aiData/isLoading} &amp;&amp; ${dashboard>/aiData/recommendations}.length === 0 }">
                                <additionalContent>
                                    <Button
                                        id="btnGenerateInsights"
                                        text="{i18n>generateSuggestions}"
                                        type="Emphasized"
                                        press="onGenerateAIInsights" />
                                </additionalContent>
                            </IllustratedMessage>
                        </VBox>
                    </content>
                </Panel>

                <!-- Quick Navigation -->
                <Panel id="panelNavigation" headerText="{i18n>quickNavigation}" expandable="false">
                    <content>
                        <layout:HorizontalLayout id="navLayout" allowWrapping="true">
                            <Button
                                id="btnNavSkills"
                                text="{i18n>viewSkillsAnalytics}"
                                icon="sap-icon://quality-issue"
                                type="Emphasized"
                                press="onNavigateToSkills"
                                class="sapUiSmallMarginEnd" />
                            <Button
                                id="btnNavPipeline"
                                text="{i18n>viewPipelineDetails}"
                                icon="sap-icon://pipeline-analysis"
                                press="onNavigateToPipeline"
                                class="sapUiSmallMarginEnd" />
                            <Button
                                id="btnNavTrends"
                                text="{i18n>viewTrends}"
                                icon="sap-icon://line-chart"
                                press="onNavigateToTrends"
                                class="sapUiSmallMarginEnd" />
                            <Button
                                id="btnNavInterviews"
                                text="{i18n>viewInterviewAnalytics}"
                                icon="sap-icon://appointment"
                                type="Accept"
                                press="onNavigateToInterviews" />
                        </layout:HorizontalLayout>
                    </content>
                </Panel>
            </layout:VerticalLayout>
        </f:content>
    </f:DynamicPage>
</mvc:View>
