<?xml version="1.0" encoding="UTF-8"?>
<mvc:View
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:core="sap.ui.core"
    controllerName="cv.sorting.analytics.controller.Trends">

    <f:DynamicPage id="trendsPage" busy="{trends>/isLoading}">
        <f:title>
            <f:DynamicPageTitle id="trendsPageTitle">
                <f:heading>
                    <Title id="trendsTitle" text="{i18n>trendsTitle}" />
                </f:heading>
                <f:snappedContent>
                    <ObjectStatus
                        id="trendsSummarySnapped"
                        text="{trends>/summary/overallChange}"
                        state="{trends>/summary/overallState}" />
                </f:snappedContent>
                <f:actions>
                    <Button id="btnExportTrends" icon="sap-icon://excel-attachment" press="onExport" tooltip="{i18n>btnExport}" />
                    <Button id="btnRefreshTrends" icon="sap-icon://refresh" press="onRefresh" tooltip="{i18n>btnRefresh}" />
                </f:actions>
                <f:navigationActions>
                    <Button id="btnBackTrends" icon="sap-icon://nav-back" press="onNavBack" tooltip="{i18n>btnBack}" />
                </f:navigationActions>
            </f:DynamicPageTitle>
        </f:title>
        <f:header>
            <f:DynamicPageHeader id="trendsPageHeader" pinnable="true">
                <f:content>
                    <VBox id="trendsHeaderContent" width="100%">
                        <!-- Filters -->
                        <HBox id="trendsFilters" class="sapUiSmallMarginBottom">
                            <VBox id="metricFilterBox" class="sapUiSmallMarginEnd">
                                <Label id="metricLabel" text="{i18n>metric}" />
                                <Select id="metricSelect" selectedKey="{trends>/selectedMetric}" change="onMetricChange" items="{trends>/metrics}">
                                    <core:Item id="metricItem" key="{trends>key}" text="{trends>text}" />
                                </Select>
                            </VBox>
                            <VBox id="periodFilterBox">
                                <Label id="periodLabel" text="{i18n>period}" />
                                <Select id="periodSelect" selectedKey="{trends>/selectedPeriod}" change="onPeriodChange" items="{trends>/periods}">
                                    <core:Item id="periodItem" key="{trends>key}" text="{trends>text}" />
                                </Select>
                            </VBox>
                        </HBox>
                        <!-- Summary -->
                        <HBox id="trendsSummary" justifyContent="SpaceAround" width="100%">
                            <VBox id="avgBox" alignItems="Center" class="sapUiSmallMargin">
                                <Text id="avgValue" text="{trends>/summary/average}" class="sapMObjectNumberText" />
                                <Label id="avgLabel" text="{i18n>average}" />
                            </VBox>
                            <VBox id="maxBox" alignItems="Center" class="sapUiSmallMargin">
                                <Text id="maxValue" text="{trends>/summary/max}" class="sapMObjectNumberText" />
                                <Label id="maxLabel" text="{i18n>maximum}" />
                            </VBox>
                            <VBox id="minBox" alignItems="Center" class="sapUiSmallMargin">
                                <Text id="minValue" text="{trends>/summary/min}" class="sapMObjectNumberText" />
                                <Label id="minLabel" text="{i18n>minimum}" />
                            </VBox>
                            <VBox id="changeBox" alignItems="Center" class="sapUiSmallMargin">
                                <ObjectStatus id="overallChange" text="{trends>/summary/overallChange}" state="{trends>/summary/overallState}" />
                                <Label id="changeLabel" text="{i18n>overallChange}" />
                            </VBox>
                        </HBox>
                    </VBox>
                </f:content>
            </f:DynamicPageHeader>
        </f:header>
        <f:content>
            <VBox id="trendsContent" class="sapUiResponsiveContentPadding">
                <Panel id="trendDataPanel" headerText="{i18n>trendData}">
                    <content>
                        <Table id="trendsTable" items="{trends>/trendData}" growing="true" growingThreshold="20">
                            <columns>
                                <Column id="colPeriod"><Text id="colPeriodText" text="{i18n>period}" /></Column>
                                <Column id="colValue" hAlign="End"><Text id="colValueText" text="{i18n>value}" /></Column>
                                <Column id="colChange" hAlign="End"><Text id="colChangeText" text="{i18n>change}" /></Column>
                                <Column id="colTrend" hAlign="Center"><Text id="colTrendText" text="{i18n>trend}" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem id="trendListItem">
                                    <cells>
                                        <Text id="cellPeriod" text="{trends>periodLabel}" />
                                        <Text id="cellValue" text="{trends>valueText}" />
                                        <ObjectStatus id="cellChange" text="{trends>changeText}" state="{trends>changeState}" />
                                        <core:Icon id="cellTrendIcon" src="{trends>changeIcon}" color="{= ${trends>changeState} === 'Success' ? '#107e3e' : (${trends>changeState} === 'Error' ? '#bb0000' : '#6a6d70') }" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                </Panel>
            </VBox>
        </f:content>
    </f:DynamicPage>
</mvc:View>
