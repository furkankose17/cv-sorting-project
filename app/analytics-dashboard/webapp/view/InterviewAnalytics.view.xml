<?xml version="1.0" encoding="UTF-8"?>
<mvc:View
    xmlns:mvc="sap.ui.core.mvc"
    xmlns="sap.m"
    xmlns:f="sap.f"
    xmlns:card="sap.f.cards"
    xmlns:layout="sap.ui.layout"
    controllerName="cv.sorting.analytics.controller.InterviewAnalytics">

    <f:DynamicPage id="interviewAnalyticsPage" headerExpanded="true">
        <f:title>
            <f:DynamicPageTitle id="pageTitle">
                <f:heading>
                    <Title id="title" text="{i18n>interviewAnalytics}" />
                </f:heading>
                <f:navigationActions>
                    <Button
                        id="btnBack"
                        icon="sap-icon://nav-back"
                        press="onNavBack"
                        tooltip="{i18n>back}" />
                </f:navigationActions>
                <f:actions>
                    <Button
                        id="btnRefreshInterviews"
                        text="{i18n>refresh}"
                        icon="sap-icon://refresh"
                        press="onRefresh" />
                </f:actions>
            </f:DynamicPageTitle>
        </f:title>

        <f:content>
            <layout:VerticalLayout id="idInterviewMainVerticalLayout" width="100%" class="sapUiSmallMargin">
                <!-- Interview KPI Cards Row -->
                <layout:HorizontalLayout id="idInterviewKpiHorizontalLayout" allowWrapping="true" class="sapUiMediumMarginBottom">
                    <!-- Total Interviews Card -->
                    <f:Card id="cardTotalInterviews" class="sapUiSmallMarginEnd" width="220px">
                        <f:header>
                            <card:Header
                                id="headerTotalInterviews"
                                title="{i18n>totalInterviews}"
                                subtitle="{i18n>allScheduled}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numTotalInterviews"
                                value="{interviews>/totalScheduled}"
                                scale=""
                                valueColor="Neutral"
                                icon="sap-icon://appointment"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Completed Interviews Card -->
                    <f:Card id="cardCompleted" class="sapUiSmallMarginEnd" width="220px">
                        <f:header>
                            <card:Header
                                id="headerCompleted"
                                title="{i18n>completedInterviews}"
                                subtitle="{i18n>withFeedback}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numCompleted"
                                value="{interviews>/completed}"
                                scale=""
                                valueColor="Good"
                                icon="sap-icon://complete"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Upcoming Interviews Card -->
                    <f:Card id="cardUpcoming" class="sapUiSmallMarginEnd" width="220px">
                        <f:header>
                            <card:Header
                                id="headerUpcoming"
                                title="{i18n>upcomingInterviews}"
                                subtitle="{i18n>scheduled}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numUpcoming"
                                value="{interviews>/upcomingCount}"
                                scale=""
                                valueColor="Critical"
                                icon="sap-icon://future"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Average Rating Card -->
                    <f:Card id="cardAvgRating" class="sapUiSmallMarginEnd" width="220px">
                        <f:header>
                            <card:Header
                                id="headerAvgRating"
                                title="{i18n>avgInterviewRating}"
                                subtitle="{i18n>overallRating}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numAvgRating"
                                value="{interviews>/avgOverallRating}"
                                scale="/5"
                                valueColor="{= ${interviews>/avgOverallRating} >= 4 ? 'Good' : ${interviews>/avgOverallRating} >= 3 ? 'Neutral' : 'Error'}"
                                icon="sap-icon://favorite"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>

                    <!-- Completion Rate Card -->
                    <f:Card id="cardCompletionRate" width="220px">
                        <f:header>
                            <card:Header
                                id="headerCompletionRate"
                                title="{i18n>completionRate}"
                                subtitle="{i18n>excludingCancelled}" />
                        </f:header>
                        <f:content>
                            <NumericContent
                                id="numCompletionRate"
                                value="{interviews>/completionRate}"
                                scale="%"
                                valueColor="{= ${interviews>/completionRate} >= 80 ? 'Good' : ${interviews>/completionRate} >= 60 ? 'Neutral' : 'Error'}"
                                icon="sap-icon://bar-chart"
                                class="sapUiSmallMargin" />
                        </f:content>
                    </f:Card>
                </layout:HorizontalLayout>

                <!-- Interview Status Breakdown -->
                <Panel
                    id="panelStatusBreakdown"
                    headerText="{i18n>interviewStatusBreakdown}"
                    expandable="true"
                    expanded="true"
                    class="sapUiMediumMarginBottom">
                    <content>
                        <layout:HorizontalLayout id="statusLayout" allowWrapping="true">
                            <ObjectStatus
                                id="statusCancelled"
                                title="{i18n>cancelledInterviews}"
                                text="{interviews>/cancelled}"
                                state="Error"
                                class="sapUiSmallMarginEnd sapUiSmallMarginBottom" />
                            <ObjectStatus
                                id="statusNoShow"
                                title="{i18n>noShowInterviews}"
                                text="{interviews>/noShow}"
                                state="Warning"
                                class="sapUiSmallMarginEnd sapUiSmallMarginBottom" />
                        </layout:HorizontalLayout>
                    </content>
                </Panel>

                <!-- Ratings by Interview Type -->
                <Panel
                    id="panelRatingsByType"
                    headerText="{i18n>ratingsByInterviewType}"
                    expandable="true"
                    expanded="true"
                    class="sapUiMediumMarginBottom">
                    <content>
                        <Table
                            id="ratingsByTypeTable"
                            items="{interviews>/ratingsByType}"
                            growing="true"
                            growingThreshold="10">
                            <columns>
                                <Column id="idTypeColumn"><Text id="idTypeText" text="{i18n>interviewType}" /></Column>
                                <Column id="idAvgRatingColumn" hAlign="End"><Text id="idAvgRatingText" text="{i18n>avgRating}" /></Column>
                                <Column id="idRatingCountColumn" hAlign="End"><Text id="idRatingCountText" text="{i18n>count}" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem id="ratingTypeItem">
                                    <cells>
                                        <Text id="txtType" text="{interviews>type}" />
                                        <ObjectNumber
                                            id="numRating"
                                            number="{interviews>avgRating}"
                                            unit="/5"
                                            state="{= ${interviews>avgRating} >= 4 ? 'Success' : ${interviews>avgRating} >= 3 ? 'None' : 'Error' }" />
                                        <ObjectNumber id="numCount" number="{interviews>count}" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                </Panel>

                <!-- Detailed Ratings -->
                <Panel
                    id="panelDetailedRatings"
                    headerText="{i18n>detailedRatings}"
                    expandable="true"
                    expanded="true"
                    class="sapUiMediumMarginBottom">
                    <content>
                        <layout:Grid id="idDetailedRatingsGrid" defaultSpan="L4 M6 S12" class="sapUiSmallMargin">
                            <VBox id="vboxTechnical" class="sapUiSmallMarginBottom">
                                <Label id="lblTechnical" text="{i18n>technicalRating}" />
                                <ProgressIndicator
                                    id="progTechnical"
                                    percentValue="{= ${interviews>/avgTechnicalRating} * 20}"
                                    displayValue="{interviews>/avgTechnicalRating}/5"
                                    state="{= ${interviews>/avgTechnicalRating} >= 4 ? 'Success' : ${interviews>/avgTechnicalRating} >= 3 ? 'None' : 'Error' }" />
                            </VBox>
                            <VBox id="vboxCommunication" class="sapUiSmallMarginBottom">
                                <Label id="lblCommunication" text="{i18n>communicationRating}" />
                                <ProgressIndicator
                                    id="progCommunication"
                                    percentValue="{= ${interviews>/avgCommunicationRating} * 20}"
                                    displayValue="{interviews>/avgCommunicationRating}/5"
                                    state="{= ${interviews>/avgCommunicationRating} >= 4 ? 'Success' : ${interviews>/avgCommunicationRating} >= 3 ? 'None' : 'Error' }" />
                            </VBox>
                            <VBox id="vboxCultureFit" class="sapUiSmallMarginBottom">
                                <Label id="lblCultureFit" text="{i18n>cultureFitRating}" />
                                <ProgressIndicator
                                    id="progCultureFit"
                                    percentValue="{= ${interviews>/avgCultureFitRating} * 20}"
                                    displayValue="{interviews>/avgCultureFitRating}/5"
                                    state="{= ${interviews>/avgCultureFitRating} >= 4 ? 'Success' : ${interviews>/avgCultureFitRating} >= 3 ? 'None' : 'Error' }" />
                            </VBox>
                        </layout:Grid>
                    </content>
                </Panel>

                <!-- Upcoming Interviews List -->
                <Panel
                    id="panelUpcomingList"
                    headerText="{i18n>upcomingInterviewsList}"
                    expandable="true"
                    expanded="true">
                    <content>
                        <Table
                            id="upcomingTable"
                            items="{interviews>/upcomingInterviews}"
                            growing="true"
                            growingThreshold="10"
                            noDataText="{i18n>noUpcomingInterviews}">
                            <columns>
                                <Column id="colCandidate"><Text id="txtColCandidate" text="{i18n>candidate}" /></Column>
                                <Column id="colJob"><Text id="txtColJob" text="{i18n>jobPosting}" /></Column>
                                <Column id="colInterviewType"><Text id="txtColInterviewType" text="{i18n>type}" /></Column>
                                <Column id="colScheduledAt"><Text id="txtColScheduledAt" text="{i18n>scheduledAt}" /></Column>
                                <Column id="colInterviewer"><Text id="txtColInterviewer" text="{i18n>interviewer}" /></Column>
                                <Column id="colStatus"><Text id="txtColStatus" text="{i18n>status}" /></Column>
                            </columns>
                            <items>
                                <ColumnListItem id="upcomingItem" type="Navigation" press="onInterviewPress">
                                    <cells>
                                        <Text id="txtCandidate" text="{interviews>candidateName}" />
                                        <Text id="txtJob" text="{interviews>jobTitle}" />
                                        <Text id="txtInterviewType" text="{interviews>interviewType}" />
                                        <Text id="txtScheduledAt" text="{path: 'interviews>scheduledAt', type: 'sap.ui.model.type.DateTime', formatOptions: {style: 'medium'}}" />
                                        <Text id="txtInterviewer" text="{interviews>interviewer}" />
                                        <ObjectStatus
                                            id="objInterviewStatus"
                                            text="{interviews>status}"
                                            state="{= ${interviews>status} === 'confirmed' ? 'Success' : 'None' }" />
                                    </cells>
                                </ColumnListItem>
                            </items>
                        </Table>
                    </content>
                </Panel>
            </layout:VerticalLayout>
        </f:content>
    </f:DynamicPage>
</mvc:View>
